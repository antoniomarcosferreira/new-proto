version: 0.2
phases:
  install:
    commands:
      - go mod download
  pre_build:
    commands:
      - $(aws ecr get-login --no-include-email --region $REGION)
      - go test -coverpkg ./... ./... | { grep -v 'no test files'; true; }
  build:
    commands:
      - docker build -f build/development/Dockerfile -t mgt-staging .
      - docker tag $ECR_NAME:latest $REPOSITORY_URI:latest
      - docker push $REPOSITORY_URI:latest
